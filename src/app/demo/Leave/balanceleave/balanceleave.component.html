<div class="page-content">
  <div class="leave-balance-container" #exportDiv id="exportContent">
    <div class="header-section">
      <div>
        <h2>Leave Balance</h2>
        <div class="employee-info">
          <div class="employee-name">
            {{ employeeName }}
            <span class="employee-code" *ngIf="employeeCode">({{ employeeCode }})</span>
          </div>
          <span class="report-date">{{ currentDate }}</span>
        </div>
      </div>
      <button class="export-button" (click)="exportToPDF()">
        <i class="bi bi-upload text-black" style="font-weight: 100;"></i> Export
      </button>
    </div>

    <div class="boxed-section cards-container">
      <div class="section-title">
        <span *ngIf="isSingleView || employeeName !== 'No Employee Selected' && employeeName !== 'Employee Not Found'">
          {{ isSingleView ? 'Employee' : 'Your' }} Leave Balances
        </span>
        <span *ngIf="!isSingleView && employeeName === 'No Employee Selected'">No Employee Selected</span>
      </div>
      
      <div *ngIf="employeeName === 'No Employee Selected'" class="no-employee-selected">
        <i class="bi bi-person-x" style="font-size: 2rem; color: #6c757d;"></i>
        <p>Please select an employee to view their leave balance</p>
      </div>
      
      <div *ngIf="employeeName === 'Employee Not Found'" class="no-employee-selected">
        <i class="bi bi-exclamation-triangle" style="font-size: 2rem; color: #dc3545;"></i>
        <p>Employee not found. Please check the employee ID and try again.</p>
      </div>
      
      <div *ngIf="employeeName !== 'No Employee Selected' && employeeName !== 'Employee Not Found'" class="leave-cards-horizontal">
        <div class="leave-card" *ngFor="let balance of leaveBalances">
          <div class="card-icon">
            <i class="bi text-warning" [class]="getTypeIconClass(balance.type)"></i>
          </div>
          <h3>{{ balance.type }}</h3>
          <hr class="divider">
          <div class="leave-progress">
            <span class="used">{{ balance.used }}</span>
            <span class="separator">/</span>
            <span class="total">{{ balance.total }} Days</span>
          </div>
        </div>
      </div>
    </div>

    <div class="boxed-section history-container" *ngIf="employeeName !== 'No Employee Selected' && employeeName !== 'Employee Not Found'">
      <div class="section-header">
        <h3>Leave Request History</h3>
        <div class="header-right-group">
          <div class="filters-container">
            <div class="filter-row">
              <div class="filter-group status-dropdown">
                <div class="dropdown">
                  <button class="dropdown-toggle" (click)="toggleStatusDropdown()">
                    {{ getStatusLabel(selectedStatus) }}
                    <i class="bi bi-chevron-down"></i>
                  </button>
                  <div class="dropdown-menu" [class.show]="showStatusDropdown">
                    <button *ngFor="let status of statusFilters"
                      (click)="filterByStatus(status.value); $event.stopPropagation()">
                      <i class="bi" [class]="getStatusIconClass(status.value)" 
                         [ngClass]="{
                           'icon-approved': status.value.toLowerCase() === 'approved',
                           'icon-rejected': status.value.toLowerCase() === 'rejected'
                         }">
                      </i>
                      {{ status.label }}
                    </button>
                  </div>
                </div>
              </div>

              <div class="filter-group">
                <div class="dropdown">
                  <button class="dropdown-toggle" (click)="toggleTypeDropdown()">
                    {{ getTypeLabel(selectedType) }}
                    <i class="bi bi-chevron-down text-warning"></i>
                  </button>
                  <div class="dropdown-menu" [class.show]="showTypeDropdown">
                    <button *ngFor="let type of typeFilters" (click)="filterByType(type.value); $event.stopPropagation()">
                      <i class="bi text-warning" [class]="getTypeIconClass(type.value)"></i>
                      {{ type.label }}
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="total-records" *ngIf="filteredHistory.length > 0">{{ filteredHistory.length }} records found</div>
            <div class="no-records-message" *ngIf="filteredHistory.length === 0">No records match the selected filters</div>
          </div>
        </div>
      </div>

      <div class="history-table">
        <div class="table-header">
          <div class="request-col">Employee</div>
          <div class="leave-type-col">Leave Type</div>
          <div class="reason-col">Reason</div>
          <div class="date-col">Applied Date</div>
          <div class="status-col">Status</div>
          <div class="actions-col">Actions</div>
        </div>
        <div class="table-body">
          <ng-container *ngIf="filteredHistory.length > 0; else noDataTemplate">
            <div class="table-row" *ngFor="let item of filteredHistory">
              <div class="request-cell">
                <strong *ngIf="!isSingleView">{{ item.name || 'N/A' }}</strong>
              </div>
              <div class="leave-type-cell">
                {{ (item.type || 'N/A').replace(' - PENDING', '').replace(' - APPROVED', '').replace(' - REJECTED', '') }}
              </div>
              <div class="reason-cell">{{ item.reason || 'N/A' }}</div>
              <div class="date-cell">{{ (item.appliedDate || item.submittedOn || '') | date:'mediumDate' }}</div>
              <div class="status-cell">
                <span class="status-badge" [class]="getStatusClass(item.status)">
                  <i class="bi" [class]="getStatusIconClass(item.status?.toLowerCase() || '')"></i>
                  {{ getStatusLabel(item.status) }}
                </span>
              </div>
              <div class="actions-cell">
                <button *ngIf="item.status === 'PENDING'" 
                        class="btn btn-sm btn-success me-2" 
                        (click)="approveLeave(item)"
                        [disabled]="isProcessing">
                  <i class="bi bi-check-lg"></i> Approve
                </button>
                <button *ngIf="item.status === 'PENDING'" 
                        class="btn btn-sm btn-danger" 
                        (click)="rejectLeave(item)"
                        [disabled]="isProcessing">
                  <i class="bi bi-x-lg"></i> Reject
                </button>
                <span *ngIf="item.status !== 'PENDING'" class="text-muted">
                  {{ item.status }}
                </span>
              </div>
            </div>
          </ng-container>
          <ng-template #noDataTemplate>
            <div class="no-data-message">
              <i class="bi bi-inbox text-muted"></i>
              <p>No data available</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>