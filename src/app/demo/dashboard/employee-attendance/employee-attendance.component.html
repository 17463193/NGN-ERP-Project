<div class="att-det-container container-fluid">
  <!-- ========== HEADER SECTION ========== -->
  <div class="att-det-header d-flex justify-content-between align-items-start mb-4">
    <div>
      <h2 class="att-det-title">Employee Attendance</h2>
      <p class="att-det-subtitle text-muted mb-0">Keep track of employee attendance on a daily basis.</p>
    </div>

    <!-- Action Buttons -->
    <div class="att-det-actions d-flex gap-2 align-items-start">
      <!-- <button class="att-det-date-btn btn btn-outline-dark d-flex align-items-center">
        <i class="bi bi-calendar-week me-2"></i>
        {{ currentDate | date:'dd MMMM yyyy' }}
      </button> -->
      <button class="att-det-export-btn btn btn-warning d-flex align-items-center" (click)="exportToPdf()">
        <i class="bi bi-download me-2"></i>
        Export
      </button>
    </div>
  </div>

  <!-- Divider -->
  <div class="att-det-divider w-100 pb-3 mb-4" style="border-bottom: 1px solid #dee2e6;"></div>

  <div class="filter-container d-flex flex-wrap align-items-stretch gap-2 mb-4">
    <!-- Branch Select -->
    <div class="filter-item">
      <select class="form-select form-select-sm h-100" [(ngModel)]="selectedBranchId" (change)="onBranchChange()">
        <option value="">All Branches</option>
        <option *ngFor="let branch of branches" [value]="branch.branchId">{{ branch.branchName }}</option>
      </select>
    </div>

    <!-- Department Select -->
    <div class="filter-item">
      <select class="form-select form-select-sm h-100" [(ngModel)]="activeTab" (change)="selectTab(activeTab)">
        <option *ngFor="let dept of tabDepartments" [value]="dept">
          {{ getDepartmentName(dept) }}
        </option>
      </select>
    </div>

    <!-- Date Filter Button -->
    <div class="filter-item position-relative">
      <button type="button" 
              class="date-filter-button btn btn-outline-dark btn-sm d-flex align-items-center h-100 w-100" 
              (click)="toggleDateFilter($event); $event.stopPropagation()">
        <i class="bi bi-calendar3 me-2"></i>
        {{ currentFilterDate ? (currentFilterDate | date: 'dd MMM yyyy') : 'Select Date' }}
      </button>
      
      <!-- Date filter dropdown -->
      <div class="date-picker-dropdown card shadow-sm position-absolute top-100 start-0 mt-1" 
           *ngIf="showDateFilter" 
           style="z-index: 1050; width: 300px;"
           (click)="$event.stopPropagation()">
        <div class="card-body p-3">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="fw-bold mb-0">Select Date</h6>
            <button type="button" class="btn-close" (click)="showDateFilter = false" aria-label="Close"></button>
          </div>
          
          <form [formGroup]="dateFilterForm" (ngSubmit)="$event.preventDefault(); applyDateFilter()">
            <div class="mb-3">
              <input type="date" 
                     class="form-control form-control-sm" 
                     [min]="minDate | date: 'yyyy-MM-dd'"
                     [max]="maxDate | date: 'yyyy-MM-dd'"
                     formControlName="filterDate"
                     (click)="$event.stopPropagation()">
            </div>
            
            <div class="d-flex gap-2">
              <button type="submit" 
                      class="btn btn-primary btn-sm flex-grow-1" 
                      [disabled]="!dateFilterForm.get('filterDate').value">
                Apply
              </button>
              <button type="button" 
                      class="btn btn-outline-secondary btn-sm" 
                      (click)="clearDateFilter()"
                      *ngIf="currentFilterDate">
                Clear
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Search Input - Aligned to the right on larger screens -->
    <div class="search-container ms-md-auto">
      <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input type="text" 
               class="form-control form-control-sm border-start-0" 
               placeholder="Search by name or id..."
               [(ngModel)]="searchQuery" 
               (input)="onSearchInput($event)">
      </div>
    </div>
  </div>

  <!-- Attendance Table -->
  <div class="card border-0 shadow-sm" *ngIf="hasAppliedFilters()">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th class="py-2">Emp ID</th>
            <th class="py-2">Employee</th>
            <th class="py-2">Date</th>
            <th class="py-2">Shift</th>
            <th class="py-2">Status</th>
            <th class="py-2">Clock In</th>
            <th class="py-2">Clock Out</th>
            <th class="py-2">Late Check-In</th>
            <th class="py-2">Over Time</th>
          </tr>
        </thead>
        <tbody *ngIf="!isLoading">
          <ng-container *ngIf="attendanceData.length > 0; else noData">
            <tr *ngFor="let emp of paginatedData" class="att-det-table-row border-bottom">
              <td class="py-2 align-middle">
                <span class="text-nowrap">{{ emp.empCode || '--' }}</span>
              </td>
              <td class="py-2 align-middle">
                <div class="d-flex align-items-center">
                  <div>
                    <div class="fw-medium text-nowrap">{{ getEmployeeFullName(emp) || '--' }}</div>
                    <small class="text-muted">{{ getDepartmentDisplayName(emp) }}</small>
                  </div>
                </div>
              </td>
              <td class="py-2 align-middle">
                <span class="text-nowrap">{{ formatDate(emp.attendanceDate) || '--' }}</span>
              </td>
              <td class="py-2 align-middle">
                <span class="badge bg-warning bg-opacity-10 text-warning text-nowrap">{{ emp.timePeriod || '--' }}</span>
              </td>
              <td class="py-2 align-middle">
                <span class="badge d-inline-flex align-items-center" [ngClass]="{
                  'bg-success bg-opacity-10 text-success': emp.status === 'Present',
                  'bg-danger bg-opacity-10 text-danger': emp.status === 'Absent',
                  'bg-warning bg-opacity-10 text-warning': emp.status === 'Late',
                  'bg-info bg-opacity-10 text-info': emp.status === 'Early Departure',
                  'bg-secondary bg-opacity-10 text-secondary': !emp.status
                }">
                  {{ emp.status || '--' }}
                </span>
              </td>
              <td class="py-2 align-middle">
                <span class="text-nowrap">{{ emp.actualCheckInTime || '--' }}</span>
              </td>
              <td class="py-2 align-middle">
                <span class="text-nowrap">{{ emp.actualCheckOutTime || '--' }}</span>
              </td>
              <td class="py-2 align-middle">
                <span *ngIf="emp.lateCheckInTime && emp.lateCheckInTime !== '00:00'" class="d-inline-flex align-items-center text-danger">
                  <i class="bi bi-exclamation-triangle-fill me-1"></i>
                  <span class="text-nowrap">{{ emp.lateCheckInTime }}</span>
                </span>
                <span *ngIf="!emp.lateCheckInTime || emp.lateCheckInTime === '00:00'" class="text-muted">--</span>
              </td>
              <td class="py-2 align-middle">
                <span class="text-nowrap">{{ emp.overTime || '--' }}</span>
              </td>
            </tr>
          </ng-container>

           <ng-template #noData>
          <tr>
            <td colspan="9" class="att-det-empty text-center py-5">
              <div>
                <i class="bi bi-people display-4 d-block mb-3"></i>
                <p class="mb-2">No employee records found.</p>
              </div>
            </td>
          </tr>
        </ng-template>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="alert alert-danger mt-3">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    {{ errorMessage }}
  </div>

  <!-- Pagination -->
  <!-- <div class="row mt-3" *ngIf="attendanceData.length > 0 && !isLoading">
    <div class="col-md-6">
      <div class="dataTables_info">
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to
        {{ Math.min(currentPage * itemsPerPage, attendanceData.length) }} of {{ attendanceData.length }} entries
      </div>
    </div>
    <div class="col-md-6">
      <div class="dataTables_paginate paging_simple_numbers float-end">
        <select class="form-select form-select-sm d-inline-block w-auto me-2" [(ngModel)]="itemsPerPage"
          (change)="onItemsPerPageChange()">
          <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }} per page</option>
        </select>
        <nav>
          <ul class="pagination pagination-sm mb-0">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" href="javascript:void(0)" (click)="goToPage(1)">
                <i class="bi bi-chevron-double-left"></i>
              </a>
            </li>
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" href="javascript:void(0)" (click)="goToPage(currentPage - 1)">
                <i class="bi bi-chevron-left"></i>
              </a>
            </li>

            <li class="page-item" *ngFor="let page of getPages()" [class.active]="page === currentPage"
              [class.disabled]="page === -1">
              <a *ngIf="page !== -1" class="page-link" href="javascript:void(0)" (click)="goToPage(page)">
                {{ page }}
              </a>
              <span *ngIf="page === -1" class="page-link">...</span>
            </li>

            <li class="page-item" [class.disabled]="currentPage === totalPages()">
              <a class="page-link" href="javascript:void(0)" (click)="goToPage(currentPage + 1)">
                <i class="bi bi-chevron-right"></i>
              </a>
            </li>
            <li class="page-item" [class.disabled]="currentPage === totalPages()">
              <a class="page-link" href="javascript:void(0)" (click)="goToPage(totalPages())">
                <i class="bi bi-chevron-double-right"></i>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div> -->
  <!-- </div> -->
</div>