<div class="erp-container employee-details">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="erp-loading-state">
    <div class="erp-spinner"></div>
    <p>Loading employee details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !isLoading" class="erp-error-state">
    <i class="erp-icon-warning"></i>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Main Content -->
  <div *ngIf="employee && !isLoading">
    <h1 class="profile-title">Employee Profile</h1>
    
    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <ul class="tab-list">
        <li class="tab-item">
          <button class="tab-link" 
                  [class.active]="activeTab === 'personal'" 
                  (click)="changeTab('personal')">
            <i class="fa-solid fa-user tab-icon"></i> Personal
          </button>
        </li>
        <li class="tab-item">
          <button class="tab-link" 
                  [class.active]="activeTab === 'employment'" 
                  (click)="changeTab('employment')">
            <i class="fa-solid fa-briefcase tab-icon"></i> Employment
          </button>
        </li>
        <li class="tab-item">
          <button class="tab-link" 
                  [class.active]="activeTab === 'contact'" 
                  (click)="changeTab('contact')">
            <i class="fa-solid fa-phone tab-icon"></i> Contact
          </button>
        </li>
        <li class="tab-item">
          <button class="tab-link" 
                  [class.active]="activeTab === 'bank'" 
                  (click)="changeTab('bank')">
            <i class="fa-solid fa-university tab-icon"></i> Bank
          </button>
        </li>
        <li class="tab-item">
          <button class="tab-link" 
                  [class.active]="activeTab === 'education'" 
                  (click)="changeTab('education')">
            <i class="fa-solid fa-graduation-cap tab-icon"></i> Education
          </button>
        </li>
      </ul>
    </div>

    <!-- Two Card Layout -->
    <div class="cards-container">
      <!-- Left Card - Employee Overview -->
      <div class="overview-card">
        <!-- Profile Image -->
        <div class="profile-image-section">
          <div class="profile-image-wrapper">
             <!-- Status Badge -->
          <div class="status-badge" [ngClass]="getStatusBadgeClass(employee.employmentStatus)">
            {{ employee.employmentStatus || '-' }}
          </div>
            <div class="profile-image-placeholder" *ngIf="!profileImageUrl && !employee.profileImage">
              <i class="fa-solid fa-user"></i>
            </div>
            <img *ngIf="profileImageUrl || employee.profileImage" 
                 [src]="profileImageUrl || employee.profileImage"
                 class="profile-image" 
                 alt="Profile Photo">
            <!-- Camera Icon for Upload -->
            <div class="camera-icon-overlay">
              <input type="file" id="profileUpload" accept="image/*" 
                     (change)="onFileSelected($event)" style="display: none;">
              <label for="profileUpload" class="camera-icon">
                <i class="fa fa-camera"></i>
              </label>
            </div>
          </div>
          
          <!-- Upload Save Button -->
          <button *ngIf="selectedFile" 
                  class="save-photo-btn" 
                  (click)="uploadPhoto()"
                  [disabled]="isUploading">
            <span *ngIf="!isUploading">Save</span>
            <span *ngIf="isUploading" class="spinner-sm"></span>
          </button>
        </div>


        <!-- Employee Name -->
        <div class="employee-name-section">
          <h2 class="employee-name">{{ employee.firstName || 'Dorji' }} {{ employee.lastName || 'Penjor' }}</h2>
          <p class="employee-position">{{ employee.positionName || 'Programmer' }}</p>
        </div>

        <!-- Quick Info Cards -->
        <div class="quick-info-section">
          <div class="info-item">
            <i class="fa-regular fa-address-card info-icon"></i>
            <div class="info-content">
              <span class="info-label">Employee ID</span>
              <span class="info-value">{{ employee.empCode || 'EMP010' }}</span>
            </div>
          </div>

          <div class="info-item">
            <i class="fa fa-building-user info-icon"></i>
            <div class="info-content">
              <span class="info-label">Department</span>
              <span class="info-value">{{ employee.department || 'Ecentric' }}</span>
            </div>
          </div>

          <div class="info-item">
            <i class="fa-regular fa-calendar-days info-icon"></i>
            <div class="info-content">
              <span class="info-label">Hire Date</span>
              <span class="info-value">{{ formatDate(employee.hireDate) || '10 June 2025' }}</span>
            </div>
          </div>

          <div class="info-item">
            <i class="fa-solid fa-user-tie info-icon"></i>
            <div class="info-content">
              <span class="info-label">Position</span>
              <span class="info-value">{{ employee.positionName || 'Backend Developer' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Card - Details -->
      <div class="details-card">
        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Personal Tab -->
          <div *ngIf="activeTab === 'personal'" class="tab-panel">
            <!-- Header with Badges and Export -->
            <div class="content-header">
              <div class="content-badges">
                <span class="content-badge badge-blue">
                  <i class="fas fa-circle-exclamation"></i> {{ employee.empCode || 'EMP010' }}
                </span>
                <span class="content-badge badge-purple">
                  <i class="fa fa-user-tie"></i> {{ employee.positionName || 'Programmer' }}
                </span>
              </div>
              <button class="export-btn" (click)="exportToPDF()">
                <i class="fa fa-download"></i> Export
              </button>
            </div>

            <!-- Basic Information -->
            <div class="content-section">
              <h3 class="section-title">Basic Information</h3>
              <div class="detail-grid">
                <div class="detail-item">
                  <label>Full Name</label>
                  <p>{{ (employee.firstName || 'Dorji') + ' ' + (employee.lastName || 'Penjor') }}</p>
                </div>
                <div class="detail-item">
                  <label>Date of Birth</label>
                  <p>{{ formatDate(employee.dateOfBirth) || 'Jul 3, 1998' }}</p>
                </div>
                <div class="detail-item">
                  <label>Gender</label>
                  <p>{{ employee.gender || 'Male' }}</p>
                </div>
                <div class="detail-item">
                  <label>Marital Status</label>
                  <p>{{ employee.maritalStatus || 'Single' }}</p>
                </div>
                <div class="detail-item">
                  <label>Nationality</label>
                  <p>{{ employee.nationality || 'Bhutanese' }}</p>
                </div>
                <div class="detail-item">
                  <label>CID Number</label>
                  <p>{{ employee.cidNumber || '123111123' }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Employment Tab -->
          <div *ngIf="activeTab === 'employment'" class="tab-panel">
            <div class="content-header">
              <div class="content-badges">
                <span class="content-badge badge-blue">
                  <i class="fa fa-building"></i> {{ employee.department || 'Ecentric' }}
                </span>
                <span class="content-badge badge-purple">
                  <i class="fa fa-medal"></i> {{ employee.gradeName || 'Senior Grade' }}
                </span>
              </div>
              <button class="export-btn" (click)="exportToPDF()">
                <i class="fa fa-download"></i> Export
              </button>
            </div>

            <div class="content-section">
              <h3 class="section-title">Position Details</h3>
              <div class="detail-grid">
                <div class="detail-item">
                  <label>Department</label>
                  <p>{{ employee.department || 'Ecentric' }}</p>
                </div>
                <div class="detail-item">
                  <label>Position</label>
                  <p>{{ employee.positionName || 'Backend Developer' }}</p>
                </div>
                <div class="detail-item">
                  <label>Employment Type</label>
                  <p>{{ employee.employmentType || 'Full-time' }}</p>
                </div>
                <div class="detail-item">
                  <label>Location</label>
                  <p>{{ employee.location || 'Thimphu' }}</p>
                </div>
              </div>
            </div>

            <div class="content-section">
              <h3 class="section-title">Grade & Salary</h3>
              <div *ngIf="employee?.gradeId || true; else noGrade" class="detail-grid">
                <div class="detail-item">
                  <label>Grade</label>
                  <p>
                    {{ employee.gradeName || 'Senior Grade' }}
                    <span *ngIf="employee.gradeCode" class="grade-code">({{ employee.gradeCode }})</span>
                  </p>
                </div>
                <div class="detail-item">
                  <label>Basic Salary</label>
                  <p>{{ employee.basicSalary ? (employee.basicSalary | currency:'Nu.':'symbol':'1.2-2') : 'Nu. 45,000.00' }}</p>
                </div>
                <div class="detail-item">
                  <label>Max Salary</label>
                  <p>{{ employee.maxSalary ? (employee.maxSalary | currency:'Nu.':'symbol':'1.2-2') : 'Nu. 65,000.00' }}</p>
                </div>
              </div>
              <ng-template #noGrade>
                <div class="empty-state">
                  <i class="fa fa-info-circle"></i>
                  <p>No grade information available</p>
                </div>
              </ng-template>
            </div>
          </div>

          <!-- Contact Tab -->
          <div *ngIf="activeTab === 'contact'" class="tab-panel">
            <div class="content-header">
              <div class="content-badges">
                <span class="content-badge badge-blue">
                  <i class="fa fa-location-dot"></i> {{ employee.address?.addressLine1 || 'Thimphu' }}
                </span>
                <span class="content-badge badge-purple">
                  <i class="fa fa-phone"></i> {{ employee.contact?.phonePrimary || '+975-77123456' }}
                </span>
              </div>
              <button class="export-btn" (click)="exportToPDF()">
                <i class="fa fa-download"></i> Export
              </button>
            </div>

            <div class="content-section">
              <h3 class="section-title">Contact Information</h3>
              <div class="table-responsive">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Email</th>
                      <th>Primary Phone</th>
                      <th>Secondary Phone</th>
                      <th>Emergency Contact</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>{{ employee.contact?.email || 'dorji.penjor@ecentric.bt' }}</td>
                      <td>{{ employee.contact?.phonePrimary || '+975-77123456' }}</td>
                      <td>{{ employee.contact?.phoneSecondary || '+975-17123456' }}</td>
                      <td>
                        <span class="badge" 
                              [ngClass]="employee.contact?.isEmergencyContact ? 'badge-success' : 'badge-success'">
                          {{ employee.contact?.isEmergencyContact ? 'Yes' : 'Yes' }}
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="content-section">
              <h3 class="section-title">Address Information</h3>
              <div class="table-responsive">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Address Type</th>
                      <th>Address Line 1</th>
                      <th>Address Line 2</th>
                      <th>Thromde/Dzongkhag</th>
                      <th>Country</th>
                      <th>Current</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>{{ employee.address?.addressType || 'Permanent' }}</td>
                      <td>{{ employee.address?.addressLine1 || 'Motithang' }}</td>
                      <td>{{ employee.address?.addressLine2 || 'Near School' }}</td>
                      <td>{{ employee.address?.thromde || employee.address?.dzongkhag || 'Thimphu' }}</td>
                      <td>{{ employee.address?.country || 'Bhutan' }}</td>
                      <td>
                        <span class="badge" 
                              [ngClass]="employee.address?.isCurrent ? 'badge-success' : 'badge-success'">
                          {{ employee.address?.isCurrent ? 'Yes' : 'Yes' }}
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Bank Tab -->
          <div *ngIf="activeTab === 'bank'" class="tab-panel">
            <div class="content-header">
              <div class="content-badges">
                <span class="content-badge badge-blue">
                  <i class="fa fa-building-columns"></i> {{ employee.bankDetail?.bankName || 'Bank of Bhutan' }}
                </span>
                <span class="content-badge badge-purple">
                  <i class="fa fa-user-gear"></i> {{ employee.bankDetail?.accountNumber || '100123456789' }}
                </span>
              </div>
              <button class="export-btn" (click)="exportToPDF()">
                <i class="fa fa-download"></i> Export
              </button>
            </div>

            <div class="content-section">
              <div class="table-responsive">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Bank Name</th>
                      <th>Branch Name</th>
                      <th>Account Number</th>
                      <th>Account Type</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>{{ employee.bankDetail?.bankName || 'Bank of Bhutan' }}</td>
                      <td>{{ employee.bankDetail?.branchName || 'Thimphu Main Branch' }}</td>
                      <td>{{ employee.bankDetail?.accountNumber || '100123456789' }}</td>
                      <td>{{ employee.bankDetail?.accountType || 'Savings' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Education Tab -->
          <div *ngIf="activeTab === 'education'" class="tab-panel">
            <div class="content-header">
              <div class="content-badges">
                <span class="content-badge badge-blue">
                  <i class="fa fa-university"></i> {{ employee.qualification?.institutionName || 'Royal University of Bhutan' }}
                </span>
                <span class="content-badge badge-purple">
                  <i class="fa fa-graduation-cap"></i> {{ employee.qualification?.degreeName || 'Bachelor of IT' }}
                </span>
              </div>
              <button class="export-btn" (click)="exportToPDF()">
                <i class="fa fa-download"></i> Export
              </button>
            </div>

            <div class="content-section">
              <h3 class="section-title">Education</h3>
              <div class="table-responsive">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>College / Institution</th>
                      <th>Major</th>
                      <th>Specialization</th>
                      <th>Year of Completion</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>{{ employee.qualification?.institutionName || 'Royal University of Bhutan' }}</td>
                      <td>{{ employee.qualification?.degreeName || 'Bachelor of IT' }}</td>
                      <td>{{ employee.qualification?.specialization || 'Software Development' }}</td>
                      <td>{{ employee.qualification?.yearOfCompletion || '2020' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
