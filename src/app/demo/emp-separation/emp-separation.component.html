<div class="transfer-container">
  <!-- Header Section -->
  <div class="header">
    <div class="title">
      <h2>Separation Management</h2>
      <p>Manage and track employee separations within the organization.</p>
    </div>
    <div class="controls">
      <button class="add-btn" (click)="openAddModal()">
        <i class="ti ti-plus"></i>
        <span>New Separation</span>
      </button>
      <button class="add-btn" (click)="exportSeparations()">
        <i class="bi bi-download me-2"></i>
        <span>Export</span>
      </button>
    </div>
  </div>

  <!-- Search and Filter Row -->
  <div class="search-filter-row">
    <div class="d-flex justify-content-end w-100">
      <div class="search-filter-content">
        <div class="search-input-wrapper">
          <i class="bi bi-search"></i>
          <input 
            type="text" 
            placeholder="Search..."
            [(ngModel)]="searchQuery"
            (input)="applySearch()">
        </div>

        <div class="filter-container">
          <button class="filter-icon">
            <i class="bi bi-funnel"></i>
            <span>Filters</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Separation List -->
  <div class="transfer-table">
    <table>
      <thead>
        <tr>
          <th>Employee</th>
          <th>Separation Type</th>
          <th>Initiation Date</th>
          <th>Last Working Date</th>
          <th>Notice Period Served</th>
          <th>Reason</th>
          <th>Status</th>
          <th style="text-align: right;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let separation of paginatedSeparations">
          <td class="fw-medium">{{ separation.employeeName }}</td>
          <td>{{ separation.separationType }}</td>
          <td>{{ separation.separationDate | date:'mediumDate' }}</td>
          <td>{{ separation.lastWorkingDate | date:'mediumDate' }}</td>
          <td>
            <span class="badge" [ngClass]="separation.noticePeriodServed ? 'bg-success' : 'bg-warning text-dark'">
              {{ separation.noticePeriodServed ? 'Yes' : 'No' }}
            </span>
          </td>
          <td>{{ separation.separationReason }}</td>
          <td>
            <span class="badge" [ngClass]="getStatusBadgeClass(separation.status)">
              {{ separation.status }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="view-btn" (click)="openViewModal(separation)" title="View">
                <i class="bi bi-eye"></i>
              </button>
              <button class="edit-btn" (click)="openEditModal(separation)" title="Edit" [disabled]="separation.status === 'Completed'">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="delete-btn" (click)="confirmDelete(separation.id!)" title="Delete" [disabled]="separation.status === 'Completed'">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="filteredSeparations.length === 0">
          <td colspan="8" class="text-center">
            <div class="text-muted">
              <i class="bi bi-inbox"></i>
              <p>No separation records found</p>
              <button class="btn btn-sm btn-outline-primary" (click)="openAddModal()">
                <i class="bi bi-plus-lg me-1"></i> Add New Separation
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="simple-pagination" *ngIf="filteredSeparations.length > 0">
    <button 
      (click)="onPageChange(currentPage - 1)" 
      [disabled]="currentPage === 1">
      <i class="bi bi-chevron-left"></i> Previous
    </button>
    
    <div class="page-info">
      Page {{ currentPage }} of {{ totalPages }}
    </div>
    
    <button 
      (click)="onPageChange(currentPage + 1)" 
      [disabled]="currentPage === totalPages">
      Next <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</div>

<!-- Add/Edit Separation Modal -->
<ng-template #separationModal let-modal>
  <form [formGroup]="form" (ngSubmit)="saveSeparation()" class="needs-validation" novalidate>
    <div class="modal-header bg-primary text-white">
      <h5 class="modal-title fw-bold">{{ isEditMode ? 'Edit' : 'Add New' }} Separation</h5>
      <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss()" aria-label="Close"></button>
    </div>
    <div class="modal-body">
      <h6 class="mb-4">Employee Details</h6>
      <div class="row g-3 mb-4">
        <div class="col-12">
          <label for="employeeName" class="form-label">Employee Name *</label>
          <input 
            type="text" 
            class="form-control" 
            id="employeeName"
            formControlName="employeeName"
            [class.is-invalid]="form.get('employeeName')?.invalid && form.get('employeeName')?.touched"
            placeholder="Enter full name">
          <div class="invalid-feedback">
            Please provide a valid employee name
          </div>
        </div>
      </div>

      <h6 class="mb-4 mt-4">Separation Details</h6>
      <div class="row g-3 mb-4">
        <div class="col-md-6">
          <label for="separationType" class="form-label">Separation Type *</label>
          <select 
            class="form-select" 
            id="separationType"
            formControlName="separationType"
            [class.is-invalid]="form.get('separationType')?.invalid && form.get('separationType')?.touched">
            <option value="" disabled selected>Select Type</option>
            <option value="Resignation">Resignation</option>
            <option value="Termination">Termination</option>
            <option value="Retirement">Retirement</option>
            <option value="Contract End">Contract End</option>
          </select>
          <div class="invalid-feedback">
            Please select a separation type
          </div>
        </div>
        
        <div class="col-md-6">
          <label for="separationDate" class="form-label">Initiation Date *</label>
          <input 
            type="date" 
            class="form-control" 
            id="separationDate"
            formControlName="separationDate"
            [class.is-invalid]="form.get('separationDate')?.invalid && form.get('separationDate')?.touched"
            [min]="today">
          <div class="invalid-feedback">
            Please select a valid date
          </div>
        </div>
        
        <div class="col-md-6">
          <label for="lastWorkingDate" class="form-label">Last Working Date *</label>
          <input 
            type="date" 
            class="form-control" 
            id="lastWorkingDate"
            formControlName="lastWorkingDate"
            [class.is-invalid]="form.get('lastWorkingDate')?.invalid && form.get('lastWorkingDate')?.touched"
            [min]="form.get('separationDate')?.value || today">
          <div class="invalid-feedback">
            Please select the last working date
          </div>
        </div>
        <div class="col-md-6">
          <label for="status" class="form-label">Status *</label>
          <select 
            class="form-select" 
            id="status"
            formControlName="status"
            [class.is-invalid]="form.get('status')?.invalid && form.get('status')?.touched">
            <option value="Pending" selected>Pending</option>
            <option value="Approved">Approved</option>
            <option value="Rejected">Rejected</option>
          </select>
          <div class="invalid-feedback">
            Please select a status
          </div>
        </div>
        <div class="col-md-6">
          <label class="form-label">Notice Period Served *</label>
          <div class="form-check">
            <input 
              class="form-check-input" 
              type="checkbox" 
              id="noticePeriodServed"
              formControlName="noticePeriodServed">
            <label class="form-check-label" for="noticePeriodServed">
              Notice Period Served
            </label>
          </div>
        </div>
        
        <div class="col-12">
          <label for="notes" class="form-label">Reason *</label>
          <textarea 
            class="form-control" 
            id="notes" 
            rows="3"
            formControlName="notes"
            [class.is-invalid]="form.get('notes')?.invalid && form.get('notes')?.touched"
            placeholder="Enter the reason for separation"></textarea>
          <div class="invalid-feedback">
            Please provide a reason
          </div>
        </div>
        <!-- <div class="col-md-6">
          <label for="separationType" class="form-label">Separation Type *</label>
          <select 
            class="form-select" 
            id="separationType"
            formControlName="separationType"
            [class.is-invalid]="form.get('separationType')?.invalid && form.get('separationType')?.touched">
            <option value="">Select Type</option>
            <option *ngFor="let type of separationTypes" [value]="type">{{ type }}</option>
          </select>
          <div 
            *ngIf="form.get('separationType')?.invalid && form.get('separationType')?.touched" 
            class="invalid-feedback">
            Please select a separation type
          </div>
        </div>
        
        <div class="col-md-6">
          <label for="lastWorkingDate" class="form-label">Last Working Date *</label>
          <input 
            type="date" 
            class="form-control" 
            id="lastWorkingDate"
            formControlName="lastWorkingDate"
            [min]="form.get('separationDate')?.value || ''"
            [class.is-invalid]="form.get('lastWorkingDate')?.invalid && form.get('lastWorkingDate')?.touched">
          <div 
            *ngIf="form.get('lastWorkingDate')?.invalid && form.get('lastWorkingDate')?.touched" 
            class="invalid-feedback">
            Last working date is required and must be after separation date
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="form-check form-switch mt-4 pt-2">
            <input 
              class="form-check-input" 
              type="checkbox" 
              id="noticePeriodServed"
              formControlName="noticePeriodServed"
              style="width: 2.5em; height: 1.5em;">
            <label class="form-check-label ms-2" for="noticePeriodServed">
              Notice Period Served
            </label>
          </div>
        </div>
        
        <div class="col-md-6">
          <label for="separationType" class="form-label">Separation Type *</label>
          <select 
            class="form-select" 
            id="separationType"
            formControlName="separationType"
            [class.is-invalid]="form.get('separationType')?.invalid && form.get('separationType')?.touched">
            <option value="">Select Type</option>
            <option value="Voluntary">Voluntary</option>
            <option value="Involuntary">Involuntary</option>
            <option value="Retirement">Retirement</option>
            <option value="Resignation">Resignation</option>
            <option value="Termination">Termination</option>
          </select>
          <div 
            *ngIf="form.get('separationType')?.invalid && form.get('separationType')?.touched" 
            class="invalid-feedback">
            Separation type is required
          </div>
        </div> -->
        
        <!-- <div class="col-md-6">
          <label for="status" class="form-label">Status *</label>
          <select 
            class="form-select" 
            id="status"
            formControlName="status"
            [class.is-invalid]="form.get('status')?.invalid && form.get('status')?.touched">
            <option value="Pending">Pending</option>
            <option value="Approved">Approved</option>
            <option value="Rejected">Rejected</option>
            <option value="Completed">Completed</option>
          </select>
        </div> -->
        
        <!-- <div class="col-md-6">
          <label for="exitInterviewDate" class="form-label">Exit Interview Date</label>
          <input 
            type="date" 
            class="form-control" 
            id="exitInterviewDate"
            formControlName="exitInterviewDate">
        </div> -->
        
        <!-- <div class="col-md-6">
          <label for="clearanceStatus" class="form-label">Clearance Status</label>
          <select 
            class="form-select" 
            id="clearanceStatus"
            formControlName="clearanceStatus">
            <option value="Pending">Pending</option>
            <option value="In Progress">In Progress</option>
            <option value="Completed">Completed</option>
          </select>
        </div> -->
        
        <!-- <div class="col-12">
          <label for="notes" class="form-label">Reason for Separation</label>
          <textarea 
            class="form-control" 
            id="notes" 
            rows="3"
            formControlName="notes"
            [class.is-invalid]="form.get('notes')?.invalid && form.get('notes')?.touched"
            placeholder="Enter the reason for separation">
          </textarea>
          <div class="invalid-feedback" *ngIf="form.get('notes')?.invalid && form.get('notes')?.touched">
            Please provide a reason for separation
          </div>
        </div>
         -->
        <!-- <div class="col-12">
          <label for="notes" class="form-label">Additional Notes</label>
          <textarea 
            class="form-control" 
            id="notes" 
            rows="2"
            formControlName="notes"
            placeholder="Any additional notes or comments"></textarea>
        </div> -->
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss()">Cancel</button>
      <button type="submit" class="btn btn-primary" [disabled]="form.invalid">
        {{ isEditMode ? 'Update' : 'Save' }}
      </button>
    </div>
  </form>
</ng-template>

<!-- View Separation Details Modal -->
<ng-template #viewSeparationModal let-modal>
  <div class="modal-header bg-primary text-white">
    <h5 class="modal-title fw-bold">Separation Details</h5>
    <button type="button" class="btn-close btn-close-white" (click)="modal.dismiss()" aria-label="Close"></button>
  </div>
  <div class="modal-body" *ngIf="currentSeparation">
    <div class="row mb-3">
      <div class="col-md-6">
        <h6 class="text-muted">Employee</h6>
        <p class="mb-1 fw-medium">{{ currentSeparation.employeeName }}</p>
        <small class="text-muted">{{ currentSeparation.employeeId }}</small>
      </div>
      <div class="col-md-6">
        <h6 class="text-muted">Department</h6>
        <p class="mb-0">{{ currentSeparation.department }}</p>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <h6 class="text-muted">Position</h6>
        <p class="mb-0">{{ currentSeparation.position }}</p>
      </div>
      <div class="col-md-6">
        <h6 class="text-muted">Initiation Date</h6>
        <p class="mb-0">{{ currentSeparation.separationDate | date:'mediumDate' }}</p>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <h6 class="text-muted">Separation Type</h6>
        <p class="mb-0">{{ currentSeparation.separationType }}</p>
      </div>
      <div class="col-md-6">
        <h6 class="text-muted">Status</h6>
        <span class="badge" [ngClass]="getStatusBadgeClass(currentSeparation.status)">
          {{ currentSeparation.status }}
        </span>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <h6 class="text-muted">Last Working Date</h6>
        <p class="mb-0">{{ currentSeparation.lastWorkingDate | date:'mediumDate' }}</p>
      </div>
      <div class="col-md-6">
        <h6 class="text-muted">Notice Period</h6>
        <p class="mb-0">
          <span class="badge me-2" [ngClass]="currentSeparation.noticePeriodServed ? 'bg-success' : 'bg-warning text-dark'">
            {{ currentSeparation.noticePeriodServed ? 'Served' : 'Not Served' }}
          </span>
          <span *ngIf="calculateNoticePeriodDays(currentSeparation.separationDate, currentSeparation.lastWorkingDate) > 0">
            ({{ calculateNoticePeriodDays(currentSeparation.separationDate, currentSeparation.lastWorkingDate) }} days)
          </span>
        </p>
        <h6 class="text-muted mb-1">Reason for Separation</h6>
        <p class="mb-3">{{ currentSeparation.separationReason || 'N/A' }}</p>
      </div>
      
      <div class="col-12" *ngIf="currentSeparation.notes">
        <h6 class="text-muted mb-1">Additional Notes</h6>
        <p class="mb-0">{{ currentSeparation.notes || 'N/A' }}</p>
      </div>
      
      <div class="col-md-6" *ngIf="currentSeparation.approvedBy">
        <h6 class="text-muted mb-1">Approved By</h6>
        <p class="mb-3">{{ currentSeparation.approvedBy }}</p>
      </div>
      
      <div class="col-md-6" *ngIf="currentSeparation.approvedDate">
        <h6 class="text-muted mb-1">Approval Date</h6>
        <p class="mb-3">{{ currentSeparation.approvedDate | date:'mediumDate' }}</p>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Close</button>
  </div>
</ng-template>
